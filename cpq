#!/usr/bin/env python3
import sys
import os
from src import compiler

def main(input_file):
    file_path, sep = os.path.splitext(input_file)
    if sep != '.ou':
        print('error: the input file is not with ".ou" extension', file=sys.stderr)
        return

    with open(input_file) as f:
        program = f.read()
    comp = compiler.Compiler(program)
    quad_code = comp.run()
    if quad_code:
        with open('{}.qud'.format(file_path), 'w') as fp:
            fp.write(quad_code)
            fp.write("\n/* Generated by Uriya Yavniely's compiler */\n")

if __name__ == '__main__':
    main(sys.argv[1])
